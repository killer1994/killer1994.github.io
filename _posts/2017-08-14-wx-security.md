---
layout: post
title: "微信公众号的安全性"
description: ""
category: 
tags: []
---
{% include JB/setup %}

### 参考资料

[微信公众平台接入的安全性](http://starlight36.com/post/secrity-of-weixin-public-platform-api)

[什么是 TLS 中间人攻击？如何防范这类攻击？](https://www.zhihu.com/question/20744215)

[中间人攻击](https://baike.baidu.com/item/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/1739730?fr=aladdin)

### 摘要

> 紧接上文，在微信后台给服务器转发消息时，通过signature，timestamp，nonce，echostr 接入服务器，接入申请到达后，接口端通过Token进行验证signature的有效性，验证通过后，将echostr参数原样输出返回给微信平台。
>
> 这里需要注意官方消息接口指南中的一个疏漏，就是并没有提示**任何一次请求都必须校验签名**。一些开发者可能忽略了这个细节，在未验证签名的情况下就处理了请求。这一点需要格外注意。
>
> 然而，这并不意味着，签名验证通过，请求就是安全的。这里有一种**重现攻击**的办法——截获（或者通过访问日志泄露）微信服务器和接口服务器的请求，使得某次的请求参数泄露。如果单纯按照上面的办法验证签名，这意味着任何一次请求的参数在将来的任何时候，都是有效的。
>
> 为了防止签名的重用，我们可以进行以下两点防范措施：
> * 检查timestamp有效性。由于服务器之间存在时差，所以timestamp只要保证一个窗口时间范围内有效即可。
> * signature防重用。由于两次请求产生相同签名的几率非常小，所以我们只要将使用过的签名暂时屏蔽。这可能需要借助memcache这种K-V缓存进行。屏蔽时间稍大于上面的timestamp窗口时间即可。
>
> 但是这样还不足以保证消息的彻底安全，因为上面的手段还无法防止“**中间人攻击**”。双向证书模式认证，可以避免这个攻击风险。
>
> 由于signature的生成并不包含报文信息，所以即使signature正确，也无法保证通讯报文未被**篡改**。为了一定程度上解决这个问题，请严谨地验证微信消息请求中的CreateTime字段，和timestamp字段是否在合理的时间窗内，这样可以降低篡改消息攻击的风险，但是并不能完全消除。
>
> 由此可见，微信公众平台消息接入，只适用于那些并不机要的消息传递。在真正的使用中，也推荐只进行诸如非敏感信息查询等服务。

思考：上面讨论了微信后台转发给服务器的安全性，那么如果服务器通过微信后台主动推送给微信用户，是否安全可靠？


